<div class="row align-items-center">
  <h4 class="col-6 mb-3">DÃ©tail du fichier</h4>
  <P class="col-6 mb-3 text-end">
    <button class="btn btn-primary" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFilters" aria-expanded="false" aria-controls="collapseFilters">
      Filters
    </button>
  </P>
</div>
@if ((file$ | async); as file) {
  <div>
    <div class="collapse" id="collapseFilters">
      <!-- Filtres (placeholder, pas encore branchÃ©s) -->
      <div class="card mb-3">
        <div class="card-body">
          <div class="row g-2 align-items-end">
            <div class="col-12 col-md-4">
              <label class="form-label">Recherche texte</label>
              <input class="form-control" placeholder="ex: .text / driver.c"
                     [value]="(filterText())" disabled><!-- todo <input class="form-control" placeholder="ex: .text / driver.c"
               [(ngModel)]="(filterText())" disabled>  -->
              <!-- dÃ©sactivÃ© pour lâ€™instant -->
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Section</label>
              <select class="form-select" [value]="(filterSection())" disabled> <!-- todo <select class="form-select" [(ngModel)]="(filterSection())" disabled>   -->
                <option [ngValue]="null">Toutes</option>
                <option value=".text">.text</option>
                <option value=".data">.data</option>
                <option value=".bss">.bss</option>
              </select>
            </div>
            <div class="col-6 col-md-3">
              <label class="form-label">Type mÃ©moire</label>
              <select class="form-select" [value]="(filterType())" disabled> <!-- todo <select class="form-select" [(ngModel)]="(filterType())" disabled> -->
                <option [ngValue]="null">Tous</option>
                <option value="FLASH">FLASH</option>
                <option value="RAM">RAM</option>
                <option value="ROM">ROM</option>
              </select>
            </div>
            <div class="col-12 col-md-2 text-md-end">
              <label class="form-label d-none d-md-block">&nbsp;</label>
              <button class="btn btn-outline-secondary w-100" disabled>Appliquer</button>
            </div>
          </div>
          <div class="form-text mt-2">Les filtres sont placeholders. On les rendra actifs aprÃ¨s validation du flux ðŸ‘Œ</div>
        </div>
      </div>
    </div>
  </div>



<!-- RÃ©sumÃ© + page size -->
<div class="d-flex justify-content-between align-items-center mb-2">
  <div class="text-muted small">Total: <strong>{{ total() }}</strong> entrÃ©es</div>
  <div class="d-flex align-items-center gap-2">
    <span class="small">Lignes/page</span>
    <select class="form-select form-select-sm" style="width: auto;"
            (change)="setPageSize($any($event.target).value)">
      <option [selected]="pageSize()===10"  value="10">10</option>
      <option [selected]="pageSize()===25"  value="25">25</option>
      <option [selected]="pageSize()===50"  value="50">50</option>
      <option [selected]="pageSize()===100" value="100">100</option>
      <option [selected]="pageSize()===total()" value="{{ total() }}">max</option>
    </select>
  </div>
</div>

<!-- Table -->
<div class="table-responsive">
  <table class="table table-sm table-hover align-middle">
    <thead class="table-light">
    <tr>
      <th>Section</th>
      <th>Adresse</th>
      <th>Taille</th>
      <th>Type</th>
      <th>Fichier source</th>
    </tr>
    </thead>

    @if (paged().length > 0) {
      <tbody>
      <tr *ngFor="let e of paged(); trackBy: trackRow">
        <td><code>{{ e.section_full }}</code></td>
        <td><code>{{ hex(e.address) }}</code></td>
        <td>{{ bytes(e.size) }}</td>
        <td><span class="badge text-bg-secondary">{{ e.memory_region?.memory_type || 'â€”' }}</span></td>
        <td class="text-truncate" style="max-width: 360px;" title="{{ e.file }}">{{ e.file }}</td>
      </tr>
      </tbody>
    } @else {
      <tbody>
      <tr>
        <td colspan="5" class="text-muted text-center">Pas de donnÃ©es Ã  afficher.</td>
      </tr>
      </tbody>
    }
  </table>
</div>

<!-- Pagination -->
<nav aria-label="Pagination" class="mt-2">
  <ul class="pagination pagination-sm mb-0">
    <li class="page-item" [class.disabled]="page()===1">
      <button class="page-link" (click)="goto(1)">Â«</button>
    </li>
    <li class="page-item" [class.disabled]="page()===1">
      <button class="page-link" (click)="prev()">PrÃ©c.</button>
    </li>

    <li class="page-item disabled">
        <span class="page-link bg-light">
          Page {{ page() }} / {{ totalPages() }}
        </span>
    </li>

    <li class="page-item" [class.disabled]="page()===totalPages()">
      <button class="page-link" (click)="next()">Suiv.</button>
    </li>
    <li class="page-item" [class.disabled]="page()===totalPages()">
      <button class="page-link" (click)="goto(totalPages())">Â»</button>
    </li>
  </ul>
</nav>

} @else {
  <div class="alert alert-secondary">Aucun fichier sÃ©lectionnÃ© pour lâ€™instant.</div>
}
